# æœºå™¨äººè°ƒåº¦ç³»ç»Ÿ - å¼€å‘æ–‡æ¡£

## 1. é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº Go è¯­è¨€å¼€å‘çš„æœºå™¨äººè°ƒåº¦ç³»ç»Ÿåç«¯æœåŠ¡ï¼Œé‡‡ç”¨ Gin + GORM æŠ€æœ¯æ ˆï¼Œæä¾› RESTful API æ¥å£ã€‚

### 1.1 æŠ€æœ¯æ ˆ

- **Webæ¡†æ¶**: Gin 1.11.0
- **ORM**: GORM 1.30.0
- **æ•°æ®åº“**: PostgreSQL / SQLite
- **æ—¥å¿—**: zap + lumberjack
- **é…ç½®ç®¡ç†**: Viper
- **è®¤è¯**: JWT (golang-jwt/jwt/v5)
- **APIæ–‡æ¡£**: Swagger (swaggo)
- **Goç‰ˆæœ¬**: 1.25.6

### 1.2 é¡¹ç›®ç»“æ„

```
robot_scheduler/
â”œâ”€â”€ cmd/                    # åº”ç”¨å…¥å£
â”‚   â””â”€â”€ main.go
â”œâ”€â”€ configs/                # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ config.yaml
â”œâ”€â”€ internal/               # å†…éƒ¨ä»£ç 
â”‚   â”œâ”€â”€ api/                # APIå±‚
â”‚   â”‚   â”œâ”€â”€ handler/        # è¯·æ±‚å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ middleware/     # ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ router/         # è·¯ç”±é…ç½®
â”‚   â”œâ”€â”€ config/             # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ dao/                # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â””â”€â”€ interfaces/     # DAOæ¥å£å®šä¹‰
â”‚   â”œâ”€â”€ database/           # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â”œâ”€â”€ logger/             # æ—¥å¿—ç®¡ç†
â”‚   â”œâ”€â”€ model/              # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ dto/            # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚   â””â”€â”€ entity/         # å®ä½“æ¨¡å‹
â”‚   â”œâ”€â”€ service/            # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â””â”€â”€ utils/              # å·¥å…·å‡½æ•°
â”œâ”€â”€ docs/                   # æ–‡æ¡£
â””â”€â”€ logs/                   # æ—¥å¿—æ–‡ä»¶
```

## 2. æ¶æ„è®¾è®¡

### 2.1 åˆ†å±‚æ¶æ„

é¡¹ç›®é‡‡ç”¨ç»å…¸çš„ä¸‰å±‚æ¶æ„ï¼š

```
Handler (APIå±‚)
    â†“
Service (ä¸šåŠ¡é€»è¾‘å±‚)
    â†“
DAO (æ•°æ®è®¿é—®å±‚)
    â†“
Database (æ•°æ®åº“)
```

**å„å±‚èŒè´£ï¼š**

- **Handlerå±‚**: å¤„ç†HTTPè¯·æ±‚ï¼Œå‚æ•°éªŒè¯ï¼Œè°ƒç”¨Serviceå±‚ï¼Œè¿”å›å“åº”
- **Serviceå±‚**: ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œæ•°æ®è½¬æ¢ï¼Œäº‹åŠ¡ç®¡ç†
- **DAOå±‚**: æ•°æ®åº“CRUDæ“ä½œï¼Œä½¿ç”¨GORMè¿›è¡Œæ•°æ®è®¿é—®
- **Entityå±‚**: æ•°æ®åº“å®ä½“æ¨¡å‹å®šä¹‰

### 2.2 ä¾èµ–æ³¨å…¥

ä½¿ç”¨æ¥å£å®šä¹‰DAOå±‚ï¼Œé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–ï¼š

```go
// æ¥å£å®šä¹‰
type UserDAO interface {
    Create(ctx context.Context, user *entity.UserInfo) error
    FindByID(ctx context.Context, id uint) (*entity.UserInfo, error)
    // ...
}

// å®ç°
type UserDAOImpl struct {
    db *gorm.DB
}

// æ„é€ å‡½æ•°æ³¨å…¥
func NewUserService(userDAO dao.UserDAO) *UserService {
    return &UserService{userDAO: userDAO}
}
```

## 3. æ¡†æ¶è¯„ä¼° - ç”Ÿäº§çº§åˆ«ç³»ç»Ÿé€‚ç”¨æ€§åˆ†æ

### 3.1 âœ… ä¼˜åŠ¿

#### 3.1.1 æ¶æ„è®¾è®¡è‰¯å¥½
- âœ… æ¸…æ™°çš„åˆ†å±‚æ¶æ„ï¼ŒèŒè´£åˆ†ç¦»æ˜ç¡®
- âœ… ä½¿ç”¨æ¥å£å®šä¹‰DAOå±‚ï¼Œä¾¿äºæµ‹è¯•å’Œæ‰©å±•
- âœ… ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œå“åº”æ ¼å¼
- âœ… ä¸­é—´ä»¶æœºåˆ¶å®Œå–„ï¼ˆRecovery, Logger, CORS, JWT, æƒé™ï¼‰

#### 3.1.2 æŠ€æœ¯é€‰å‹åˆç†
- âœ… Ginæ¡†æ¶æ€§èƒ½ä¼˜ç§€ï¼Œé€‚åˆé«˜å¹¶å‘åœºæ™¯
- âœ… GORMåŠŸèƒ½å®Œå–„ï¼Œæ”¯æŒå¤šç§æ•°æ®åº“
- âœ… zapæ—¥å¿—åº“æ€§èƒ½ä¼˜ç§€ï¼Œæ”¯æŒç»“æ„åŒ–æ—¥å¿—
- âœ… Viperé…ç½®ç®¡ç†çµæ´»
- âœ… Swagger APIæ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ

#### 3.1.3 åŸºç¡€åŠŸèƒ½å®Œå–„
- âœ… JWTè®¤è¯æœºåˆ¶
- âœ… åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ï¼ˆRBACï¼‰
- âœ… ä¼˜é›…å…³é—­ï¼ˆGraceful Shutdownï¼‰
- âœ… æ—¥å¿—è½®è½¬å’Œå‹ç¼©
- âœ… æ•°æ®åº“è¿æ¥æ± é…ç½®

### 3.2 âš ï¸ å­˜åœ¨çš„é—®é¢˜å’Œæ”¹è¿›å»ºè®®

#### 3.2.1 å®‰å…¨æ€§é—®é¢˜ ğŸ”´ ä¸¥é‡

**é—®é¢˜1: å¯†ç åŠ å¯†ç®—æ³•ä¸å®‰å…¨**
- **ç°çŠ¶**: ä½¿ç”¨DESåŠ å¯†å­˜å‚¨å¯†ç 
- **é£é™©**: DESç®—æ³•å·²è¢«ç ´è§£ï¼Œå®‰å…¨æ€§æä½
- **å»ºè®®**: 
  ```go
  // ä½¿ç”¨bcryptæˆ–argon2
  import "golang.org/x/crypto/bcrypt"
  
  // åŠ å¯†
  hashedPassword, err := bcrypt.GenerateFromPassword([]byte(password), bcrypt.DefaultCost)
  
  // éªŒè¯
  err := bcrypt.CompareHashAndPassword(hashedPassword, []byte(password))
  ```

**é—®é¢˜2: CORSé…ç½®è¿‡äºå®½æ¾**
- **ç°çŠ¶**: `Access-Control-Allow-Origin: *` å…è®¸æ‰€æœ‰æ¥æº
- **é£é™©**: å­˜åœ¨CSRFæ”»å‡»é£é™©
- **å»ºè®®**: 
  ```go
  // ç”Ÿäº§ç¯å¢ƒåº”è¯¥é™åˆ¶ç‰¹å®šåŸŸå
  c.Writer.Header().Set("Access-Control-Allow-Origin", "https://yourdomain.com")
  ```

**é—®é¢˜3: JWT Secretç¡¬ç¼–ç é£é™©**
- **ç°çŠ¶**: JWT Secretåœ¨é…ç½®æ–‡ä»¶ä¸­
- **å»ºè®®**: ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†æœåŠ¡ï¼ˆå¦‚Vaultï¼‰

**é—®é¢˜4: ç¼ºå°‘è¯·æ±‚é¢‘ç‡é™åˆ¶**
- **é£é™©**: å®¹æ˜“è¢«DDoSæ”»å‡»
- **å»ºè®®**: é›†æˆé™æµä¸­é—´ä»¶ï¼ˆå¦‚ `github.com/ulule/limiter/v3`ï¼‰

#### 3.2.2 æ•°æ®ä¸€è‡´æ€§é—®é¢˜ ğŸŸ¡ ä¸­ç­‰

**é—®é¢˜1: ç¼ºå°‘äº‹åŠ¡å¤„ç†**
- **ç°çŠ¶**: Serviceå±‚æ²¡æœ‰äº‹åŠ¡ç®¡ç†ç¤ºä¾‹
- **å»ºè®®**: 
  ```go
  func (s *UserService) CreateUserWithProfile(ctx context.Context, req *dto.UserCreateRequest) error {
      return s.db.Transaction(func(tx *gorm.DB) error {
          // åˆ›å»ºç”¨æˆ·
          if err := tx.Create(user).Error; err != nil {
              return err
          }
          // åˆ›å»ºç”¨æˆ·èµ„æ–™
          if err := tx.Create(profile).Error; err != nil {
              return err
          }
          return nil
      })
  }
  ```

**é—®é¢˜2: ç¼ºå°‘æ•°æ®åº“è¿ç§»**
- **ç°çŠ¶**: åªæœ‰SQLæ–‡ä»¶ï¼Œæ²¡æœ‰è‡ªåŠ¨è¿ç§»æœºåˆ¶
- **å»ºè®®**: ä½¿ç”¨GORMçš„AutoMigrateæˆ–ä¸“é—¨çš„è¿ç§»å·¥å…·ï¼ˆå¦‚golang-migrateï¼‰

#### 3.2.3 å¯ç»´æŠ¤æ€§é—®é¢˜ ğŸŸ¡ ä¸­ç­‰

**é—®é¢˜1: é”™è¯¯å¤„ç†ä¸å¤Ÿç»Ÿä¸€**
- **ç°çŠ¶**: é”™è¯¯ä¿¡æ¯ç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå¯èƒ½æ³„éœ²å†…éƒ¨ä¿¡æ¯
- **å»ºè®®**: 
  ```go
  // å®šä¹‰é”™è¯¯ç 
  const (
      ErrCodeUserNotFound = 1001
      ErrCodeInvalidPassword = 1002
  )
  
  // ç»Ÿä¸€é”™è¯¯å“åº”
  type AppError struct {
      Code    int
      Message string
      Err     error
  }
  ```

**é—®é¢˜2: ç¼ºå°‘è¯·æ±‚å‚æ•°éªŒè¯**
- **ç°çŠ¶**: ä½¿ç”¨Ginçš„ShouldBindJSONï¼Œä½†ç¼ºå°‘è¯¦ç»†çš„éªŒè¯è§„åˆ™
- **å»ºè®®**: ä½¿ç”¨ `github.com/go-playground/validator/v10`
  ```go
  type UserCreateRequest struct {
      UserName string `json:"user_name" binding:"required,min=3,max=20"`
      Password string `json:"password" binding:"required,min=8"`
      Role     string `json:"role" binding:"required,oneof=administrator manager operator user"`
  }
  ```

**é—®é¢˜3: ç¼ºå°‘å•å…ƒæµ‹è¯•**
- **ç°çŠ¶**: é¡¹ç›®ä¸­æ²¡æœ‰æµ‹è¯•æ–‡ä»¶
- **å»ºè®®**: ä¸ºServiceå±‚å’ŒHandlerå±‚ç¼–å†™å•å…ƒæµ‹è¯•

#### 3.2.4 æ€§èƒ½é—®é¢˜ ğŸŸ¡ ä¸­ç­‰

**é—®é¢˜1: ç¼ºå°‘ç¼“å­˜å±‚**
- **å»ºè®®**: å¯¹äºé¢‘ç¹æŸ¥è¯¢çš„æ•°æ®ï¼ˆå¦‚ç”¨æˆ·ä¿¡æ¯ã€æƒé™ä¿¡æ¯ï¼‰ä½¿ç”¨Redisç¼“å­˜

**é—®é¢˜2: æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–**
- **ç°çŠ¶**: éƒ¨åˆ†æŸ¥è¯¢å¯èƒ½äº§ç”ŸN+1é—®é¢˜
- **å»ºè®®**: ä½¿ç”¨GORMçš„Preloadé¢„åŠ è½½å…³è”æ•°æ®

**é—®é¢˜3: ç¼ºå°‘åˆ†é¡µ**
- **ç°çŠ¶**: ListUsersç­‰æ¥å£è¿”å›æ‰€æœ‰æ•°æ®
- **å»ºè®®**: å®ç°åˆ†é¡µæŸ¥è¯¢
  ```go
  type Pagination struct {
      Page     int `form:"page" binding:"min=1"`
      PageSize int `form:"page_size" binding:"min=1,max=100"`
  }
  ```

#### 3.2.5 å¯è§‚æµ‹æ€§é—®é¢˜ ğŸŸ¡ ä¸­ç­‰

**é—®é¢˜1: ç¼ºå°‘ç›‘æ§æŒ‡æ ‡**
- **å»ºè®®**: é›†æˆPrometheusç›‘æ§
  ```go
  import "github.com/prometheus/client_golang/prometheus"
  
  var (
      httpRequestsTotal = prometheus.NewCounterVec(...)
      httpRequestDuration = prometheus.NewHistogramVec(...)
  )
  ```

**é—®é¢˜2: å¥åº·æ£€æŸ¥è¿‡äºç®€å•**
- **ç°çŠ¶**: åªæœ‰ç®€å•çš„çŠ¶æ€æ£€æŸ¥
- **å»ºè®®**: å¢åŠ æ•°æ®åº“è¿æ¥æ£€æŸ¥ã€ä¾èµ–æœåŠ¡æ£€æŸ¥

#### 3.2.6 éƒ¨ç½²å’Œè¿ç»´ ğŸŸ¡ ä¸­ç­‰

**é—®é¢˜1: ç¼ºå°‘Dockeræ”¯æŒ**
- **å»ºè®®**: æ·»åŠ Dockerfileå’Œdocker-compose.yml

**é—®é¢˜2: ç¼ºå°‘CI/CDé…ç½®**
- **å»ºè®®**: æ·»åŠ GitHub Actionsæˆ–GitLab CIé…ç½®

**é—®é¢˜3: é…ç½®ç®¡ç†**
- **å»ºè®®**: æ”¯æŒç¯å¢ƒå˜é‡è¦†ç›–é…ç½®æ–‡ä»¶

## 4. å¼€å‘æŒ‡å—

### 4.1 ç¯å¢ƒå‡†å¤‡

```bash
# å®‰è£…Go 1.25.6æˆ–æ›´é«˜ç‰ˆæœ¬
go version

# å®‰è£…ä¾èµ–
go mod download

# å®‰è£…swagå·¥å…·ï¼ˆç”¨äºç”ŸæˆAPIæ–‡æ¡£ï¼‰
go install github.com/swaggo/swag/cmd/swag@latest
```

### 4.2 æ•°æ®åº“åˆå§‹åŒ–

#### PostgreSQL
```bash
# åˆ›å»ºæ•°æ®åº“
createdb robot_scheduler

# æ‰§è¡ŒSQLè„šæœ¬
psql -U postgres -d robot_scheduler -f internal/model/entity/sql/postreg.sql
```

#### SQLite
```bash
# SQLiteä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®åº“æ–‡ä»¶
# é¦–æ¬¡è¿è¡Œå‰éœ€è¦æ‰§è¡ŒSQLè„šæœ¬
sqlite3 data/robot.db < internal/model/entity/sql/sqlite.sql
```

### 4.3 é…ç½®è¯´æ˜

ç¼–è¾‘ `configs/config.yaml`:

```yaml
app:
  name: "robot-scheduler"
  version: "1.0.0"
  mode: "release"  # debug, release, test
  port: 8080
  read_timeout: 60
  write_timeout: 60

database:
  default: "postgres"  # postgres, sqlite
  postgres:
    host: "localhost"
    port: 5432
    user: "postgres"
    password: "your_password"
    dbname: "robot_scheduler"
    sslmode: "disable"
    max_idle_conns: 10
    max_open_conns: 100
    conn_max_lifetime: 3600

auth:
  des_key: "12345678"  # âš ï¸ ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹
  jwt_secret: "your-secret-key-change-in-production"  # âš ï¸ ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹
  jwt_expire_hours: 24
```

### 4.4 è¿è¡Œé¡¹ç›®

```bash
# å¼€å‘æ¨¡å¼
go run cmd/main.go

# æˆ–æŒ‡å®šé…ç½®æ–‡ä»¶
go run cmd/main.go configs/config.yaml

# ç”ŸæˆAPIæ–‡æ¡£
swag init -g cmd/main.go -o docs

# è®¿é—®Swaggeræ–‡æ¡£
# http://localhost:8080/swagger/index.html
```

### 4.5 æ·»åŠ æ–°åŠŸèƒ½

#### æ­¥éª¤1: å®šä¹‰å®ä½“æ¨¡å‹

```go
// internal/model/entity/product.go
package entity

import "gorm.io/gorm"

type Product struct {
    gorm.Model
    Name  string `gorm:"type:text;not null"`
    Price float64 `gorm:"type:decimal(10,2)"`
}
```

#### æ­¥éª¤2: å®šä¹‰DTO

```go
// internal/model/dto/product.go
package dto

type ProductCreateRequest struct {
    Name  string  `json:"name" binding:"required"`
    Price float64 `json:"price" binding:"required,min=0"`
}

type ProductResponse struct {
    ID    uint    `json:"id"`
    Name  string  `json:"name"`
    Price float64 `json:"price"`
}
```

#### æ­¥éª¤3: å®šä¹‰DAOæ¥å£å’Œå®ç°

```go
// internal/dao/interfaces/product.go
package interfaces

type ProductDAO interface {
    Create(ctx context.Context, product *entity.Product) error
    FindByID(ctx context.Context, id uint) (*entity.Product, error)
    FindAll(ctx context.Context) ([]*entity.Product, error)
}

// internal/dao/product.go
package impl

type ProductDAOImpl struct {
    db *gorm.DB
}

func NewProductDAO(db *gorm.DB) dao.ProductDAO {
    return &ProductDAOImpl{db: db}
}

func (d *ProductDAOImpl) Create(ctx context.Context, product *entity.Product) error {
    return d.db.WithContext(ctx).Create(product).Error
}
```

#### æ­¥éª¤4: å®ç°Serviceå±‚

```go
// internal/service/product.go
package service

type ProductService struct {
    productDAO dao.ProductDAO
}

func NewProductService(productDAO dao.ProductDAO) *ProductService {
    return &ProductService{productDAO: productDAO}
}

func (s *ProductService) CreateProduct(ctx context.Context, req *dto.ProductCreateRequest) (*entity.Product, error) {
    product := &entity.Product{
        Name:  req.Name,
        Price: req.Price,
    }
    if err := s.productDAO.Create(ctx, product); err != nil {
        return nil, err
    }
    return product, nil
}
```

#### æ­¥éª¤5: å®ç°Handlerå±‚

```go
// internal/api/handler/product.go
package handler

type ProductHandler struct {
    productService *service.ProductService
}

func NewProductHandler(productService *service.ProductService) *ProductHandler {
    return &ProductHandler{productService: productService}
}

func (h *ProductHandler) CreateProduct(c *gin.Context) {
    var req dto.ProductCreateRequest
    if err := c.ShouldBindJSON(&req); err != nil {
        BadRequest(c, "æ— æ•ˆçš„è¯·æ±‚å‚æ•°: "+err.Error())
        return
    }
    
    product, err := h.productService.CreateProduct(c.Request.Context(), &req)
    if err != nil {
        InternalServerError(c, "åˆ›å»ºäº§å“å¤±è´¥: "+err.Error())
        return
    }
    
    Success(c, product)
}
```

#### æ­¥éª¤6: æ³¨å†Œè·¯ç”±

```go
// internal/api/router/router.go
func SetupRouter(router *gin.Engine, cfg *config.Config) {
    // ...
    
    productDAO := impl.NewProductDAO(db)
    productService := service.NewProductService(productDAO)
    productHandler := handler.NewProductHandler(productService)
    
    api := router.Group("/api/v1")
    authenticated := api.Group("")
    authenticated.Use(middleware.JWTAuth(authConfig.JWTSecret))
    {
        products := authenticated.Group("/products")
        {
            products.POST("", productHandler.CreateProduct)
            products.GET("/:id", productHandler.GetProduct)
            products.GET("", productHandler.ListProducts)
        }
    }
}
```

## 5. æœ€ä½³å®è·µ

### 5.1 é”™è¯¯å¤„ç†

```go
// å®šä¹‰ä¸šåŠ¡é”™è¯¯
var (
    ErrUserNotFound = errors.New("ç”¨æˆ·ä¸å­˜åœ¨")
    ErrInvalidPassword = errors.New("å¯†ç é”™è¯¯")
)

// Serviceå±‚è¿”å›ä¸šåŠ¡é”™è¯¯
func (s *UserService) GetUser(ctx context.Context, id uint) (*entity.UserInfo, error) {
    user, err := s.userDAO.FindByID(ctx, id)
    if err != nil {
        return nil, err
    }
    if user == nil {
        return nil, ErrUserNotFound
    }
    return user, nil
}

// Handlerå±‚è½¬æ¢é”™è¯¯
func (h *UserHandler) GetUser(c *gin.Context) {
    user, err := h.userService.GetUser(c.Request.Context(), id)
    if err != nil {
        if errors.Is(err, ErrUserNotFound) {
            NotFound(c, "ç”¨æˆ·ä¸å­˜åœ¨")
        } else {
            InternalServerError(c, "è·å–ç”¨æˆ·å¤±è´¥")
        }
        return
    }
    Success(c, user)
}
```

### 5.2 äº‹åŠ¡å¤„ç†

```go
func (s *OrderService) CreateOrder(ctx context.Context, req *dto.OrderCreateRequest) error {
    return s.db.Transaction(func(tx *gorm.DB) error {
        // åˆ›å»ºè®¢å•
        order := &entity.Order{...}
        if err := tx.Create(order).Error; err != nil {
            return err
        }
        
        // æ‰£å‡åº“å­˜
        if err := tx.Model(&entity.Product{}).
            Where("id = ?", req.ProductID).
            Update("stock", gorm.Expr("stock - ?", req.Quantity)).Error; err != nil {
            return err
        }
        
        return nil
    })
}
```

### 5.3 å‚æ•°éªŒè¯

```go
import "github.com/go-playground/validator/v10"

type UserCreateRequest struct {
    UserName string `json:"user_name" binding:"required,min=3,max=20" validate:"alphanum"`
    Email    string `json:"email" binding:"required,email"`
    Password string `json:"password" binding:"required,min=8"`
}

// è‡ªå®šä¹‰éªŒè¯å™¨
func validatePassword(fl validator.FieldLevel) bool {
    password := fl.Field().String()
    // æ£€æŸ¥å¯†ç å¼ºåº¦
    return len(password) >= 8 && containsUpper(password) && containsLower(password)
}
```

### 5.4 æ—¥å¿—è®°å½•

```go
// ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—
logger.Info("user created",
    zap.Uint("user_id", user.ID),
    zap.String("username", user.UserName),
    zap.String("role", string(user.Role)),
)

// è®°å½•é”™è¯¯æ—¶åŒ…å«ä¸Šä¸‹æ–‡
logger.Error("failed to create user",
    zap.Error(err),
    zap.String("username", req.UserName),
    zap.Any("request", req),
)
```

## 6. éƒ¨ç½²å»ºè®®

### 6.1 ç”Ÿäº§ç¯å¢ƒé…ç½®

1. **ä¿®æ”¹é»˜è®¤é…ç½®**
   - ä¿®æ”¹JWT Secretå’ŒDES Key
   - é™åˆ¶CORSæ¥æº
   - è®¾ç½®åˆé€‚çš„æ—¥å¿—çº§åˆ«ï¼ˆinfoæˆ–warnï¼‰

2. **æ•°æ®åº“ä¼˜åŒ–**
   - ä½¿ç”¨PostgreSQLç”Ÿäº§ç¯å¢ƒ
   - é…ç½®è¿æ¥æ± å‚æ•°
   - å¯ç”¨SSLè¿æ¥

3. **å®‰å…¨åŠ å›º**
   - ä½¿ç”¨HTTPS
   - é…ç½®é˜²ç«å¢™è§„åˆ™
   - å®šæœŸæ›´æ–°ä¾èµ–åŒ…

### 6.2 Dockeréƒ¨ç½²

```dockerfile
# Dockerfile
FROM golang:1.25-alpine AS builder
WORKDIR /app
COPY go.mod go.sum ./
RUN go mod download
COPY . .
RUN go build -o robot-scheduler cmd/main.go

FROM alpine:latest
RUN apk --no-cache add ca-certificates
WORKDIR /root/
COPY --from=builder /app/robot-scheduler .
COPY --from=builder /app/configs ./configs
CMD ["./robot-scheduler"]
```

## 7. æ€»ç»“

### 7.1 æ¡†æ¶è¯„ä¼°ç»“è®º

**æ€»ä½“è¯„ä»·**: â­â­â­â­ (4/5)

è¯¥æ¡†æ¶**åŸºæœ¬é€‚åˆ**å°å‹ç”Ÿäº§çº§åˆ«ç³»ç»Ÿï¼Œä½†éœ€è¦è§£å†³ä»¥ä¸‹å…³é”®é—®é¢˜ï¼š

1. **å¿…é¡»ä¿®å¤**ï¼ˆç”Ÿäº§å‰ï¼‰:
   - âœ… æ›¿æ¢DESå¯†ç åŠ å¯†ä¸ºbcrypt
   - âœ… é™åˆ¶CORSé…ç½®
   - âœ… æ·»åŠ è¯·æ±‚é™æµ
   - âœ… å®ç°æ•°æ®åº“è¿ç§»

2. **å¼ºçƒˆå»ºè®®**ï¼ˆç”Ÿäº§å‰ï¼‰:
   - âœ… æ·»åŠ å•å…ƒæµ‹è¯•
   - âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†
   - âœ… æ·»åŠ å‚æ•°éªŒè¯
   - âœ… å®ç°åˆ†é¡µæŸ¥è¯¢

3. **å»ºè®®æ”¹è¿›**ï¼ˆåç»­è¿­ä»£ï¼‰:
   - âœ… æ·»åŠ ç¼“å­˜å±‚
   - âœ… é›†æˆç›‘æ§ç³»ç»Ÿ
   - âœ… æ·»åŠ Dockeræ”¯æŒ
   - âœ… å®ç°CI/CD

### 7.2 é€‚ç”¨åœºæ™¯

âœ… **é€‚åˆ**:
- ä¸­å°å‹ä¼ä¸šå†…éƒ¨ç³»ç»Ÿ
- APIæœåŠ¡ï¼ˆå¾®æœåŠ¡æ¶æ„ä¸­çš„å•ä¸ªæœåŠ¡ï¼‰
- å¿«é€ŸåŸå‹å¼€å‘
- ä½å¹¶å‘åœºæ™¯ï¼ˆ<1000 QPSï¼‰

âš ï¸ **éœ€è¦æ”¹è¿›åé€‚åˆ**:
- é«˜å¹¶å‘åœºæ™¯ï¼ˆ>1000 QPSï¼‰
- å¯¹å®‰å…¨æ€§è¦æ±‚æé«˜çš„ç³»ç»Ÿ
- å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿ

âŒ **ä¸é€‚åˆ**:
- è¶…å¤§è§„æ¨¡ç³»ç»Ÿï¼ˆéœ€è¦æ›´å¤æ‚çš„æ¶æ„ï¼‰
- å®æ—¶æ€§è¦æ±‚æé«˜çš„ç³»ç»Ÿï¼ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ—ç­‰ï¼‰

### 7.3 åç»­ä¼˜åŒ–è·¯çº¿å›¾

**Phase 1: å®‰å…¨åŠ å›º** (1-2å‘¨)
- æ›¿æ¢å¯†ç åŠ å¯†ç®—æ³•
- é™åˆ¶CORS
- æ·»åŠ é™æµ
- å®‰å…¨å®¡è®¡

**Phase 2: åŠŸèƒ½å®Œå–„** (2-3å‘¨)
- æ·»åŠ å•å…ƒæµ‹è¯•
- ç»Ÿä¸€é”™è¯¯å¤„ç†
- å‚æ•°éªŒè¯
- åˆ†é¡µæŸ¥è¯¢

**Phase 3: æ€§èƒ½ä¼˜åŒ–** (2-3å‘¨)
- æ·»åŠ ç¼“å­˜
- æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
- ç›‘æ§å’Œå‘Šè­¦

**Phase 4: è¿ç»´å®Œå–„** (1-2å‘¨)
- DockeråŒ–
- CI/CD
- æ–‡æ¡£å®Œå–„

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-01-XX  
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ
